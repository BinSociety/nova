<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovaStore | Tienda Online de Tecnolog√≠a y Accesorios</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="NovaStore - Tu tienda online de tecnolog√≠a, accesorios y productos electr√≥nicos en Paraguay. Env√≠os a todo el pa√≠s en 24/48hs.">
    <meta name="keywords" content="tecnolog√≠a, accesorios, electr√≥nica, compras online, Paraguay, tienda online, novastore">
    <meta name="author" content="NovaStore">
    <meta property="og:title" content="NovaStore | Tienda Online de Tecnolog√≠a">
    <meta property="og:description" content="Los mejores productos tecnol√≥gicos al mejor precio. Env√≠os a todo Paraguay.">
    <meta property="og:image" content="https://ik.imagekit.io/staxxcraft/unnamed.jpg">
    <meta property="og:type" content="website">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="https://img.icons8.com/color/48/shopping-bag.png">
    <link rel="apple-touch-icon" href="https://img.icons8.com/color/96/shopping-bag.png">
    
    <!-- External CSS/JS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        /* Estilos base */
        body { 
            -webkit-tap-highlight-color: transparent; 
            overflow-x: hidden;
        }
        
        /* Scrollbar personalizado */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animaciones y efectos */
        .product-card { 
            transition: transform 0.2s, box-shadow 0.2s; 
        }
        .product-card:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3); 
        }
        .product-card:active { transform: scale(0.98); }

        /* Gradientes */
        .btn-brand {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        /* Modal animations */
        .slide-screen {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
            z-index: 60;
            opacity: 0;
            pointer-events: none;
        }
        .slide-screen {
            transform: translateY(100%);
        }
        @media (min-width: 768px) {
            .slide-screen {
                transform: translateY(20px); 
            }
        }
        .slide-screen.active {
            transform: translateY(0) !important;
            opacity: 1;
            pointer-events: auto;
        }

        .glass {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(4px);
            z-index: 55;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Mobile menu */
        .mobile-menu {
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        .mobile-menu.active {
            transform: translateX(0);
        }

        /* Skeleton loading */
        .skeleton {
            background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Line clamp */
        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
        }
        .line-clamp-3 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 3;
        }

        /* Acorde√≥n */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .accordion-content.active {
            max-height: 500px;
        }

        /* Mejoras para acordeones */
        #brand-list button, #model-list button {
            border-bottom: 1px solid rgba(30, 41, 59, 0.5);
        }

        #brand-list button:last-child, #model-list button:last-child {
            border-bottom: none;
        }

        /* Transici√≥n suave para √≠conos de acorde√≥n */
        #brand-accordion i, #model-accordion i {
            transition: transform 0.3s ease;
        }

        /* Estado activo para botones de tipo */
        #type-funda.active, #type-estuche.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-slate-950 text-white font-sans selection:bg-blue-500 selection:text-white">

    <!-- Google Analytics Placeholder -->
    <!-- Replace with your GA4 tag -->
    <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script> -->

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black/50 z-40 hidden" onclick="toggleMobileMenu()"></div>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="mobile-menu fixed left-0 top-0 h-full w-64 bg-slate-900 z-50 border-r border-slate-800 p-6">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-xl font-bold">Men√∫</h2>
            <button onclick="toggleMobileMenu()" class="text-slate-400 hover:text-white">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
        </div>
        <nav class="space-y-4">
            <a href="#" class="block py-2 text-slate-300 hover:text-white transition"><i class="fa-solid fa-home mr-3"></i> Inicio</a>
            <a href="#" class="block py-2 text-slate-300 hover:text-white transition"><i class="fa-solid fa-store mr-3"></i> Tienda</a>
            <a href="#" class="block py-2 text-slate-300 hover:text-white transition"><i class="fa-solid fa-users mr-3"></i> Nosotros</a>
            <a href="#" class="block py-2 text-slate-300 hover:text-white transition"><i class="fa-solid fa-envelope mr-3"></i> Contacto</a>
            <hr class="border-slate-800 my-4">
            <a href="#" class="block py-2 text-slate-300 hover:text-white transition"><i class="fa-solid fa-truck mr-3"></i> Env√≠os</a>
            <a href="#" class="block py-2 text-slate-300 hover:text-white transition"><i class="fa-solid fa-shield-alt mr-3"></i> Garant√≠a</a>
            <a href="#" class="block py-2 text-slate-300 hover:text-white transition"><i class="fa-solid fa-file-contract mr-3"></i> T√©rminos</a>
        </nav>
    </div>

    <!-- Main Wrapper -->
    <div class="max-w-7xl mx-auto min-h-screen bg-slate-950 border-x border-slate-900 shadow-2xl relative">

        <!-- ================= MAIN VIEW ================= -->
        <div id="main-view" class="pb-24 transition-transform duration-300 min-h-screen">
            
            <!-- HEADER -->
            <header class="fixed top-0 w-full max-w-7xl glass z-30 border-b border-slate-800">
                <div class="flex justify-between items-center p-4 md:px-8">
                    <!-- Logo -->
                    <div class="flex items-center gap-2 cursor-pointer group" onclick="renderProducts('todo')">
                        <div class="w-8 h-8 md:w-10 md:h-10 rounded-lg bg-blue-600 flex items-center justify-center text-white font-bold shadow-lg shadow-blue-500/30 group-hover:bg-blue-500 transition">
                            <i class="fa-solid fa-cube text-lg md:text-xl"></i>
                        </div>
                        <h1 class="text-xl md:text-2xl font-bold tracking-tight text-white">Nova<span class="text-blue-500">Store</span></h1>
                    </div>

                    <!-- Desktop Navigation -->
                    <div class="hidden md:flex gap-6 text-sm font-medium text-slate-300">
                        <a href="#" class="hover:text-white transition">Inicio</a>
                        <a href="#" class="hover:text-white transition">Tienda</a>
                        <a href="#" class="hover:text-white transition">Nosotros</a>
                        <a href="#" class="hover:text-white transition">Contacto</a>
                    </div>

                    <!-- Icons & Search -->
                    <div class="flex gap-4 md:gap-6 items-center">
                        <!-- Search Button (Mobile) -->
                        <button class="md:hidden text-slate-300 hover:text-white" onclick="toggleSearch()">
                            <i class="fa-solid fa-search text-xl"></i>
                        </button>
                        
                        <!-- Desktop Search -->
                        <div class="hidden md:block relative">
                            <input type="text" id="search-input" placeholder="Buscar productos..." 
                                   class="bg-slate-800 border border-slate-700 rounded-lg pl-10 pr-4 py-2 text-sm w-64 focus:outline-none focus:border-blue-500">
                            <i class="fa-solid fa-search absolute left-3 top-3 text-slate-400 text-sm"></i>
                        </div>

                        <!-- Cart -->
                        <button class="relative group" onclick="openCart()">
                            <i class="fa-solid fa-shopping-bag text-xl md:text-2xl text-slate-300 group-hover:text-white transition"></i>
                            <span id="cart-count" class="absolute -top-1 -right-1 bg-blue-500 text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-bold">0</span>
                        </button>
                        
                        <!-- Mobile Menu Button -->
                        <button class="text-slate-300 hover:text-white md:hidden" onclick="toggleMobileMenu()">
                            <i class="fa-solid fa-bars text-xl"></i>
                        </button>
                        
                        <!-- Admin Button (Desktop) -->
                        <button class="hidden md:block bg-slate-800 px-4 py-2 rounded-lg text-xs font-bold border border-slate-700 hover:bg-slate-700 transition">
                            Admin
                        </button>
                    </div>
                </div>

                <!-- Mobile Search Bar -->
                <div id="mobile-search" class="md:hidden p-4 border-t border-slate-800 hidden">
                    <div class="relative">
                        <input type="text" id="mobile-search-input" placeholder="Buscar productos..." 
                               class="w-full bg-slate-800 border border-slate-700 rounded-lg pl-10 pr-4 py-2 text-sm focus:outline-none focus:border-blue-500">
                        <i class="fa-solid fa-search absolute left-3 top-3 text-slate-400 text-sm"></i>
                    </div>
                </div>

                <!-- Categories -->
                <div class="flex overflow-x-auto gap-3 px-4 md:px-8 pb-3 no-scrollbar border-t border-slate-800/50 pt-3 md:justify-center">
                    <button onclick="filter(this, 'todo')" class="cat-btn px-4 py-1.5 rounded-full bg-blue-600 text-white font-bold text-sm whitespace-nowrap shadow-lg shadow-blue-900/20 transition hover:scale-105">Todos</button>
                    <button onclick="filter(this, 'tech')" class="cat-btn px-4 py-1.5 rounded-full bg-slate-800 text-slate-300 text-sm whitespace-nowrap border border-slate-700 hover:bg-slate-700 transition hover:scale-105">üì± Tech</button>
                    <button onclick="filter(this, 'accesorios')" class="cat-btn px-4 py-1.5 rounded-full bg-slate-800 text-slate-300 text-sm whitespace-nowrap border border-slate-700 hover:bg-slate-700 transition hover:scale-105">üéß Accesorios</button>
                    <button onclick="filter(this, 'outlet')" class="cat-btn px-4 py-1.5 rounded-full bg-slate-800 text-slate-300 text-sm whitespace-nowrap border border-slate-700 hover:bg-slate-700 transition hover:scale-105">üè∑Ô∏è Outlet</button>
                    <button onclick="filter(this, 'fundas-laminas')" class="cat-btn px-4 py-1.5 rounded-full bg-slate-800 text-slate-300 text-sm whitespace-nowrap border border-slate-700 hover:bg-slate-700 transition hover:scale-105">üì± Fundas/L√°minas</button>
                </div>
            </header>

            <!-- PROMO BANNER -->
            <!-- PROMO BANNER - Fundas y L√°minas -->
            <div class="mt-36 md:mt-40 mx-3 md:mx-8 mb-8 p-6 md:p-10 rounded-2xl bg-gradient-to-r from-cyan-900 to-slate-900 border border-cyan-800/50 relative overflow-hidden group cursor-pointer hover:border-cyan-600/50 transition duration-500">
                <div class="absolute right-0 top-0 w-32 h-32 md:w-64 md:h-64 bg-cyan-500/20 rounded-full blur-3xl -mr-10 -mt-10 md:-mr-20 md:-mt-20 group-hover:bg-cyan-500/30 transition duration-700"></div>
                <div class="relative z-10 max-w-lg">
                    <h3 class="text-xl md:text-3xl font-bold text-white mb-2">‚ú® Personaliza tu Tel√©fono</h3>
                    <p class="text-sm md:text-base text-slate-300 mb-2">Elige entre nuestra variedad de fundas y l√°minas protectoras para cada modelo.</p>
                    <div class="flex flex-wrap gap-2 mb-4">
                        <span class="px-3 py-1 bg-slate-800/50 rounded-full text-xs text-slate-300">iPhone</span>
                        <span class="px-3 py-1 bg-slate-800/50 rounded-full text-xs text-slate-300">Samsung</span>
                        <span class="px-3 py-1 bg-slate-800/50 rounded-full text-xs text-slate-300">Xiaomi</span>
                        <span class="px-3 py-1 bg-slate-800/50 rounded-full text-xs text-slate-300">+20 marcas</span>
                    </div>
                    <!-- Cambiado: Ahora abre directamente el producto de Funda Protectora para iPhone (ID 9) -->
                    <button onclick="openProduct(9)" class="bg-cyan-600 hover:bg-cyan-700 text-white px-5 py-2.5 rounded-lg text-sm font-bold transition flex items-center gap-2 group/btn">
                        <span>Explorar Accesorios</span>
                        <i class="fa-solid fa-arrow-right group-hover/btn:translate-x-1 transition-transform"></i>
                    </button>
                </div>
            </div>

            <!-- PRODUCTS GRID -->
            <main class="px-3 md:px-8 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 md:gap-6" id="feed-container">
                <!-- Products loaded by JavaScript -->
            </main>

            <!-- LOADING SKELETON (Hidden by default) -->
            <div id="loading-skeleton" class="px-3 md:px-8 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 md:gap-6 hidden">
                <div class="product-card bg-slate-900 rounded-xl overflow-hidden border border-slate-800 h-64 skeleton"></div>
                <div class="product-card bg-slate-900 rounded-xl overflow-hidden border border-slate-800 h-64 skeleton"></div>
                <div class="product-card bg-slate-900 rounded-xl overflow-hidden border border-slate-800 h-64 skeleton"></div>
                <div class="product-card bg-slate-900 rounded-xl overflow-hidden border border-slate-800 h-64 skeleton"></div>
                <div class="product-card bg-slate-900 rounded-xl overflow-hidden border border-slate-800 h-64 skeleton"></div>
            </div>

            <!-- WHATSAPP FLOATING BUTTON -->
            <a href="https://wa.me/595986725905" target="_blank" class="fixed bottom-6 right-4 md:right-8 bg-[#25D366] text-white px-4 py-3 md:px-6 md:py-4 rounded-full flex items-center gap-3 font-bold z-20 shadow-lg shadow-green-900/30 active:scale-95 transition-transform hover:-translate-y-1 hover:shadow-green-500/40 group">
                <i class="fa-brands fa-whatsapp text-2xl"></i>
                <span class="hidden md:inline group-hover:inline">¬°Cont√°ctanos!</span>
            </a>
        </div>
    </div>

    <!-- MODAL OVERLAY (Desktop only) -->
    <div id="modal-overlay" class="modal-overlay hidden md:block" onclick="closeProduct()"></div>

    <!-- PRODUCT DETAIL VIEW -->
    <div id="product-view" class="fixed inset-0 md:w-[950px] md:h-[650px] md:max-w-[95vw] md:max-h-[90vh] md:m-auto bg-slate-950 md:bg-slate-900 md:rounded-2xl overflow-y-auto no-scrollbar md:overflow-hidden slide-screen shadow-2xl md:border md:border-slate-700 flex flex-col md:flex-row">
        
        <!-- Close Button (Mobile) -->
        <button onclick="closeProduct()" class="md:hidden fixed top-4 left-4 z-[70] bg-black/40 backdrop-blur text-white w-10 h-10 rounded-full flex items-center justify-center border border-white/10">
            <i class="fa-solid fa-arrow-left"></i>
        </button>

        <!-- Close Button (Desktop) -->
        <button onclick="closeProduct()" class="hidden md:flex absolute top-4 right-4 z-[70] bg-slate-800/80 text-white w-8 h-8 rounded-full items-center justify-center hover:bg-red-500">
            <i class="fa-solid fa-xmark"></i>
        </button>

        <!-- Product Image -->
        <div class="relative h-[45vh] md:h-full w-full md:w-1/2 bg-black">
            <img id="p-img" src="" class="w-full h-full object-cover" onerror="this.src='https://images.unsplash.com/photo-1556656793-08538906a9f8?w=800&q=80'">
            <div id="p-badge" class="absolute top-4 right-4 bg-blue-600 text-white text-xs font-bold px-3 py-1 rounded-full z-10">Nuevo</div>
        </div>

        <!-- Product Info -->
        <div class="flex flex-col flex-1 h-full bg-slate-950 md:bg-slate-900 overflow-hidden">
            <div class="p-6 md:p-8 overflow-y-auto no-scrollbar flex-1 pb-32 md:pb-8">
                <p id="p-cat" class="text-blue-400 text-sm font-bold uppercase tracking-wider mb-1">Categor√≠a</p>
                <h1 id="p-title" class="text-2xl md:text-3xl font-bold leading-tight mb-3 text-white">Nombre del Producto</h1>
                
                <div class="flex items-center gap-3 mb-6">
                    <p id="p-price" class="text-3xl font-bold text-white font-mono">0 Gs</p>
                    <span id="p-old-price" class="text-slate-500 line-through text-lg hidden">0 Gs</span>
                </div>

                <!-- Flavors Section (Dynamic) -->
                <div id="flavors-section" class="mb-6 hidden">
                    <h3 class="font-bold text-slate-200 mb-3 text-lg">Selecciona un Sabor</h3>
                    <div id="flavors-container" class="flex flex-wrap gap-2"></div>
                </div>

                <!-- Phone Model Section (for fundas-laminas) -->
                <div id="phone-model-section" class="mb-6 hidden">
                    <h3 class="font-bold text-slate-200 mb-3 text-lg">Selecciona tu tel√©fono</h3>
                    <div class="space-y-4">
                        <!-- Selecci√≥n de tipo: Funda o Estuche -->
                        <div>
                            <label class="block text-sm font-medium text-slate-400 mb-2">Tipo de producto</label>
                            <div class="flex gap-2">
                                <button id="type-funda" onclick="selectType('funda')" class="flex-1 py-2 px-4 rounded-lg border border-slate-700 bg-blue-600 border-blue-500 text-white transition">
                                    <i class="fa-solid fa-mobile-screen mr-2"></i> Funda
                                </button>
                                <button id="type-estuche" onclick="selectType('estuche')" class="flex-1 py-2 px-4 rounded-lg border border-slate-700 bg-slate-800 text-slate-300 hover:bg-slate-700 transition">
                                    <i class="fa-solid fa-briefcase mr-2"></i> Estuche
                                </button>
                            </div>
                        </div>

                        <!-- Acorde√≥n para Marca -->
                        <div>
                            <button id="brand-accordion" class="w-full bg-slate-800 p-3 rounded-xl border border-slate-700 flex justify-between items-center hover:bg-slate-700 transition">
                                <span id="selected-brand-text" class="flex items-center gap-2">
                                    <i class="fa-solid fa-mobile-alt"></i>
                                    <span>Selecciona la marca</span>
                                </span>
                                <i class="fa-solid fa-chevron-down transition-transform"></i>
                            </button>
                            <div id="brand-list" class="accordion-content bg-slate-900/50 rounded-xl mt-1 border border-slate-800 max-h-60 overflow-y-auto">
                                <!-- Marcas se llenar√°n din√°micamente -->
                            </div>
                        </div>

                        <!-- Acorde√≥n para Modelo -->
                        <div>
                            <button id="model-accordion" class="w-full bg-slate-800 p-3 rounded-xl border border-slate-700 flex justify-between items-center hover:bg-slate-700 transition">
                                <span id="selected-model-text" class="flex items-center gap-2">
                                    <i class="fa-solid fa-layer-group"></i>
                                    <span>Selecciona el modelo</span>
                                </span>
                                <i class="fa-solid fa-chevron-down transition-transform"></i>
                            </button>
                            <div id="model-list" class="accordion-content bg-slate-900/50 rounded-xl mt-1 border border-slate-800 max-h-60 overflow-y-auto">
                                <!-- Modelos se llenar√°n din√°micamente -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Description -->
                <div class="mb-6">
                    <h3 class="font-bold text-slate-200 mb-2">Descripci√≥n</h3>
                    <p id="p-desc" class="text-slate-400 text-sm leading-relaxed bg-slate-900/50 p-4 rounded-xl border border-slate-800 line-clamp-3">
                        Detalles del producto...
                    </p>
                </div>

                <!-- Features -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-slate-800 p-3 rounded-xl border border-slate-700 flex items-center gap-3">
                        <i class="fa-solid fa-shield-halved text-blue-500"></i>
                        <span class="text-xs text-slate-300 font-bold">Garant√≠a 30 d√≠as</span>
                    </div>
                    <div class="bg-slate-800 p-3 rounded-xl border border-slate-700 flex items-center gap-3">
                        <i class="fa-solid fa-truck-fast text-green-500"></i>
                        <span class="text-xs text-slate-300 font-bold">Env√≠o Express</span>
                    </div>
                </div>
            </div>

            <!-- Fixed Buy Button -->
            <div class="p-4 md:p-8 bg-slate-950/80 md:bg-slate-900/80 border-t border-slate-800 backdrop-blur-md">
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="addToCartFromModal()" class="bg-slate-800 hover:bg-slate-700 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 border border-slate-700 transition">
                        <span>Agregar</span>
                        <i class="fa-solid fa-cart-plus"></i>
                    </button>
                    <button onclick="buyNow()" class="btn-brand text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 shadow-lg shadow-blue-900/50 hover:opacity-90 transition">
                        <span>Comprar Ahora</span>
                        <i class="fa-solid fa-bolt"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- CART MODAL -->
    <div id="cart-modal" class="fixed inset-0 bg-black/50 z-[100] hidden items-center justify-center p-4">
        <div class="bg-slate-900 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Header -->
            <div class="p-6 border-b border-slate-800 flex justify-between items-center">
                <h2 class="text-2xl font-bold">Tu Carrito</h2>
                <button onclick="closeCart()" class="text-slate-400 hover:text-white">
                    <i class="fa-solid fa-times text-2xl"></i>
                </button>
            </div>

            <!-- Cart Items -->
            <div id="cart-items-container" class="flex-1 overflow-y-auto p-6 space-y-4">
                <!-- Cart items will be loaded here -->
                <p class="text-slate-500 text-center py-8">Tu carrito est√° vac√≠o</p>
            </div>

            <!-- Footer -->
            <div class="p-6 border-t border-slate-800">
                <div class="flex justify-between items-center mb-6">
                    <span class="text-lg font-bold">Total:</span>
                    <span id="cart-total" class="text-2xl font-bold text-blue-400">0 Gs</span>
                </div>
                <button onclick="checkout()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2">
                    <span>Finalizar Compra por WhatsApp</span>
                    <i class="fa-brands fa-whatsapp"></i>
                </button>
                <p class="text-slate-500 text-xs text-center mt-4">Al finalizar, ser√°s redirigido a WhatsApp para coordinar el pago y env√≠o.</p>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="border-t border-slate-800 gradient-bg">
        <div class="max-w-7xl mx-auto px-4 md:px-8 py-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- Column 1: About -->
                <div>
                    <h3 class="text-lg font-bold mb-4 text-white">NovaStore</h3>
                    <p class="text-sm text-slate-400 mb-4">
                        Tu tienda online de tecnolog√≠a y accesorios en Paraguay. Productos de calidad con garant√≠a y env√≠o r√°pido.
                    </p>
                    <div class="flex gap-4">
                        <a href="#" class="text-slate-400 hover:text-white"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-slate-400 hover:text-white"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-slate-400 hover:text-white"><i class="fab fa-twitter"></i></a>
                    </div>
                </div>

                <!-- Column 2: Quick Links -->
                <div>
                    <h3 class="text-lg font-bold mb-4 text-white">Enlaces R√°pidos</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-slate-400 hover:text-white">Inicio</a></li>
                        <li><a href="#" class="text-slate-400 hover:text-white">Tienda</a></li>
                        <li><a href="#" class="text-slate-400 hover:text-white">Nosotros</a></li>
                        <li><a href="#" class="text-slate-400 hover:text-white">Contacto</a></li>
                    </ul>
                </div>

                <!-- Column 3: Policies -->
                <div>
                    <h3 class="text-lg font-bold mb-4 text-white">Pol√≠ticas</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-slate-400 hover:text-white">T√©rminos y Condiciones</a></li>
                        <li><a href="#" class="text-slate-400 hover:text-white">Pol√≠tica de Env√≠os</a></li>
                        <li><a href="#" class="text-slate-400 hover:text-white">Pol√≠tica de Devoluciones</a></li>
                        <li><a href="#" class="text-slate-400 hover:text-white">Garant√≠a de Productos</a></li>
                    </ul>
                </div>

                <!-- Column 4: Contact -->
                <div>
                    <h3 class="text-lg font-bold mb-4 text-white">Contacto</h3>
                    <ul class="space-y-2 text-sm">
                        <li class="text-slate-400"><i class="fas fa-phone-alt mr-2"></i> +595 986725905</li>
                        <li class="text-slate-400"><i class="fas fa-envelope mr-2"></i> info@novastore.com.py</li>
                        <li class="text-slate-400"><i class="fas fa-map-marker-alt mr-2"></i> Ypane, Paraguay</li>
                        <li class="text-slate-400"><i class="fas fa-clock mr-2"></i> Lun-Dom: 7am - 20pm</li>
                    </ul>
                </div>
            </div>

            <div class="border-t border-slate-800 mt-8 pt-8 text-center text-sm text-slate-500">
                <p>&copy; 2024 NovaStore. Todos los derechos reservados.</p>
                <p class="mt-2 text-xs">Los precios est√°n en Guaran√≠es (Gs). Productos sujetos a disponibilidad.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // --- INVENTORY ---
        const inventario = [
            { 
                id: 1, 
                titulo: "Cartucho Life Pod 10K - Sabores a elecci√≥n", 
                precio: 65000, 
                precioAnt: 75000,
                img: "https://ik.imagekit.io/staxxcraft/unnamed.jpg", 
                cat: "tech", 
                estado: "Nuevo",
                desc: "Cartucho de vapeo con capacidad de 10,000 puffs. Variedad de sabores disponibles. Equipo en perfecto estado con bater√≠a al 90%.",
                sabores: ["Menta", "Frutilla", "Uva", "Mango", "Sand√≠a", "Tutti Frutti"]
            },
            { 
                id: 2, 
                titulo: "Cable USB C - Ecopower", 
                precio: 12000, 
                precioAnt: 15000,
                img: "https://ik.imagekit.io/staxxcraft/111667.2_1.jpg", 
                cat: "accesorios", 
                estado: "Nuevo en Caja",
                desc: "Cable USB C de alta velocidad para carga r√°pida y transferencia de datos. Longitud: 1.2 metros." 
            },
            { 
                id: 3, 
                titulo: "Cargador iPhone USB C a Lightning", 
                precio: 45000, 
                precioAnt: null,
                img: "https://ik.imagekit.io/staxxcraft/111667.2_1.jpg", 
                cat: "accesorios", 
                estado: "Nuevo",
                desc: "Cargador original para iPhone con conector Lightning. Compatible con todos los modelos iPhone." 
            },
            { 
                id: 4, 
                titulo: "Xiaomi Buds Lite", 
                precio: 35000, 
                precioAnt: 50000,
                img: "https://ik.imagekit.io/staxxcraft/Auriculares_Xiaomi_XIBHR4197CN_04.webp", 
                cat: "tech", 
                estado: "Usado - Como Nuevo",
                desc: "Auriculares inal√°mbricos Xiaomi con cancelaci√≥n de ruido. Solo 20 ciclos de carga, sin detalles est√©ticos." 
            },
            { 
                id: 5, 
                titulo: "Cable Micro USB V8", 
                precio: 9000, 
                precioAnt: 11000,
                img: "https://ik.imagekit.io/staxxcraft/micro-3-m.jpg?updatedAt=1767381845378", 
                cat: "accesorios", 
                estado: "Outlet",
                desc: "Cable Micro USB para dispositivos Android. Alta durabilidad y resistencia. Producto nuevo con empaque original." 
            },
            { 
                id: 6, 
                titulo: "iPad Air 4ta Generaci√≥n", 
                precio: 3200000, 
                precioAnt: null,
                img: "https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w-800&q=80", 
                cat: "tech", 
                estado: "Usado",
                desc: "iPad Air de 4ta generaci√≥n, color Sky Blue, 64GB WiFi. Pantalla perfecta sin rayones. Ideal para estudiantes y profesionales." 
            },
            { 
                id: 7, 
                titulo: "C√°mara Canon EOS R50", 
                precio: 4500000, 
                precioAnt: 5200000,
                img: "https://images.unsplash.com/photo-1516035069371-29a1b244cc32?w=800&q=80", 
                cat: "tech", 
                estado: "Nuevo",
                desc: "C√°mara mirrorless Canon EOS R50 con lente 18-45mm. Perfecta para vlogging, fotograf√≠a de viajes y contenido creativo." 
            },
            { 
                id: 8, 
                titulo: "Silla Gamer Corsair", 
                precio: 1200000, 
                precioAnt: null,
                img: "https://images.unsplash.com/photo-1598550476439-6847785fcea6?w=800&q=80", 
                cat: "hogar", 
                estado: "Usado",
                desc: "Silla gamer ergon√≥mica de alta gama con soporte lumbar ajustable. Peque√±o detalle est√©tico en reposabrazos izquierdo." 
            },
            { 
                id: 9, 
                titulo: "Fundas y laminas para todas las marcas", 
                precio: 13000, 
                precioAnt: 20000,
                img: "https://images.unsplash.com/photo-1523206489230-c012c64b2b48?w=800&q=80", 
                cat: "fundas-laminas", 
                estado: "Nuevo",
                desc: "Fundas y lamimnas   para varios modelos disponibles. Protege tu tel√©fono de golpes y ca√≠das." 
            },
            { 
                id: 10, 
                titulo: "Laminas de Vidrio Templado", 
                precio: 15000, 
                precioAnt: 20000,
                img: "https://images.unsplash.com/photo-1588514912908-8f5891714f8d?w=800&q=80", 
                cat: "fundas-laminas", 
                estado: "Nuevo",
                desc: "L√°mina de vidrio templado para la pantalla de tu tel√©fono. Alta resistencia a los ara√±azos." 
            }
        ];

        // --- MARCAS Y MODELOS PARA FUNDAS Y LAMINAS ---
        const marcasModelos = {
            "Apple": ["iPhone 15", "iPhone 14", "iPhone 13", "iPhone 12", "iPhone 11", "iPhone X"],
            "Samsung": ["Galaxy S23", "Galaxy S22", "Galaxy S21", "Galaxy A54", "Galaxy A34", "Galaxy A14"],
            "Xiaomi": ["Redmi Note 12", "Redmi Note 11", "Poco X5", "Poco M5", "Mi 13", "Mi 12"],
            "Motorola": ["Moto G84", "Moto G73", "Moto G53", "Moto Edge 40", "Moto Edge 30"],
            "Otras": ["Huawei P30", "LG G8", "Google Pixel 7", "OnePlus 11"]
        };

        // --- CARRITO ---
        let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
        let currentProduct = null;
        let currentFlavor = null;
        let currentBrand = null;
        let currentModel = null;
        let currentType = 'funda'; // 'funda' o 'estuche'
        let isLoading = false;
        const container = document.getElementById('feed-container');
        const loadingSkeleton = document.getElementById('loading-skeleton');

        // --- RENDER PRODUCTS ---
        function renderProducts(filterTag) {
            container.innerHTML = '';
            let filtered = filterTag === 'todo' ? inventario : inventario.filter(p => p.cat === filterTag);
            
            if(filtered.length === 0) {
                container.innerHTML = `
                    <div class="col-span-2 md:col-span-5 text-center py-20">
                        <i class="fa-solid fa-box-open text-4xl mb-3 text-slate-600"></i>
                        <p class="text-slate-500">No hay productos en esta categor√≠a.</p>
                        <button onclick="renderProducts('todo')" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold transition">
                            Ver todos los productos
                        </button>
                    </div>`;
                return;
            }

            filtered.forEach(prod => {
                const card = document.createElement('div');
                const precioFmt = prod.precio.toLocaleString('es-PY');
                const precioAntFmt = prod.precioAnt ? prod.precioAnt.toLocaleString('es-PY') : '';
                
                card.className = 'product-card bg-slate-900 rounded-xl overflow-hidden border border-slate-800 relative cursor-pointer group hover:border-slate-600 transition-colors flex flex-col h-full';
                card.onclick = () => openProduct(prod.id);

                card.innerHTML = `
                    <div class="relative w-full aspect-square overflow-hidden bg-slate-800">
                        <img src="${prod.img}" 
                             loading="lazy"
                             onerror="this.src='https://images.unsplash.com/photo-1556656793-08538906a9f8?w=800&q=80'"
                             class="w-full h-full object-cover group-hover:scale-105 transition duration-500" 
                             alt="${prod.titulo}">
                        ${prod.precioAnt ? `
                            <div class="absolute top-2 left-2 bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded shadow-sm flex items-center gap-1">
                                <i class="fa-solid fa-tag text-[8px]"></i> OFERTA
                            </div>
                        ` : ''}
                        <div class="absolute bottom-2 right-2 bg-slate-900/80 backdrop-blur-sm text-white text-[10px] font-bold px-2 py-1 rounded">
                            ${prod.estado}
                        </div>
                    </div>
                    <div class="p-3 md:p-4 flex flex-col flex-1">
                        <p class="text-xs text-slate-400 mb-1 uppercase">${prod.cat}</p>
                        <h3 class="text-sm md:text-base font-bold text-white leading-tight mb-2 line-clamp-2">${prod.titulo}</h3>
                        <div class="mt-auto pt-2 flex items-end justify-between border-t border-slate-800/50">
                            <div>
                                <p class="text-lg md:text-xl font-bold text-blue-400 font-mono">${precioFmt} Gs</p>
                                ${prod.precioAnt ? `
                                    <p class="text-xs text-slate-500 line-through">${precioAntFmt} Gs</p>
                                ` : ''}
                            </div>
                            <button onclick="event.stopPropagation(); addToCart(${prod.id})" class="w-8 h-8 rounded-full bg-slate-800 border border-slate-700 flex items-center justify-center text-blue-500 hover:bg-blue-600 hover:text-white transition group-hover:bg-blue-600 group-hover:text-white">
                                <i class="fa-solid fa-plus text-xs"></i>
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // --- PRODUCT MODAL FUNCTIONS ---
        function openProduct(id) {
            const prod = inventario.find(p => p.id === id);
            if(!prod) return;

            currentProduct = prod;
            currentFlavor = null;
            currentBrand = null;
            currentModel = null;
            currentType = 'funda'; // Valor por defecto

            // Show loading
            document.getElementById('p-img').classList.add('skeleton');
            
            setTimeout(() => {
                document.getElementById('p-img').src = prod.img;
                document.getElementById('p-img').classList.remove('skeleton');
                document.getElementById('p-title').innerText = prod.titulo;
                document.getElementById('p-cat').innerText = prod.cat.toUpperCase();
                document.getElementById('p-price').innerText = prod.precio.toLocaleString('es-PY') + " Gs";
                document.getElementById('p-desc').innerText = prod.desc;
                document.getElementById('p-badge').innerText = prod.estado;

                const oldPriceEl = document.getElementById('p-old-price');
                if(prod.precioAnt) {
                    oldPriceEl.innerText = prod.precioAnt.toLocaleString('es-PY') + " Gs";
                    oldPriceEl.classList.remove('hidden');
                } else {
                    oldPriceEl.classList.add('hidden');
                }
                
                // Mostrar sabores si el producto los tiene
                const flavorsSection = document.getElementById('flavors-section');
                const flavorsContainer = document.getElementById('flavors-container');
                if(prod.sabores) {
                    flavorsSection.classList.remove('hidden');
                    flavorsContainer.innerHTML = '';
                    prod.sabores.forEach(sabor => {
                        const btn = document.createElement('button');
                        btn.className = `px-3 py-2 rounded-lg border ${currentFlavor === sabor ? 'bg-blue-600 border-blue-500 text-white' : 'bg-slate-800 border-slate-700 text-slate-300 hover:bg-slate-700'}`;
                        btn.innerText = sabor;
                        btn.onclick = () => {
                            currentFlavor = sabor;
                            document.querySelectorAll('#flavors-container button').forEach(b => {
                                b.className = 'px-3 py-2 rounded-lg border bg-slate-800 border-slate-700 text-slate-300 hover:bg-slate-700';
                            });
                            btn.className = 'px-3 py-2 rounded-lg border bg-blue-600 border-blue-500 text-white';
                        };
                        flavorsContainer.appendChild(btn);
                    });
                    // Seleccionar el primer sabor por defecto
                    if(prod.sabores.length > 0) {
                        currentFlavor = prod.sabores[0];
                        flavorsContainer.firstChild.className = 'px-3 py-2 rounded-lg border bg-blue-600 border-blue-500 text-white';
                    }
                } else {
                    flavorsSection.classList.add('hidden');
                }

                // Mostrar selector de marca/modelo si es funda/l√°mina
                const phoneModelSection = document.getElementById('phone-model-section');
                if(prod.cat === 'fundas-laminas') {
                    phoneModelSection.classList.remove('hidden');
                    // Resetear botones de tipo
                    document.getElementById('type-funda').className = 'flex-1 py-2 px-4 rounded-lg border bg-blue-600 border-blue-500 text-white';
                    document.getElementById('type-estuche').className = 'flex-1 py-2 px-4 rounded-lg border border-slate-700 bg-slate-800 text-slate-300 hover:bg-slate-700 transition';
                    // Inicializar acordeones
                    initAccordions();
                } else {
                    phoneModelSection.classList.add('hidden');
                }
                
                // Activate modal
                document.getElementById('product-view').classList.add('active');
                document.getElementById('modal-overlay').classList.add('active');
                document.body.style.overflow = 'hidden';
            }, 300);
        }

        function closeProduct() {
            document.getElementById('product-view').classList.remove('active');
            document.getElementById('modal-overlay').classList.remove('active');
            document.body.style.overflow = 'auto';
            currentProduct = null;
            currentFlavor = null;
            currentBrand = null;
            currentModel = null;
            currentType = 'funda';
        }

        // --- FUNCI√ìN PARA SELECCIONAR TIPO (FUNDA O ESTUCHE) ---
        function selectType(type) {
            currentType = type;
            
            // Actualizar estilos de botones
            document.getElementById('type-funda').className = `flex-1 py-2 px-4 rounded-lg border ${type === 'funda' ? 'bg-blue-600 border-blue-500 text-white' : 'border-slate-700 bg-slate-800 text-slate-300 hover:bg-slate-700'} transition`;
            document.getElementById('type-estuche').className = `flex-1 py-2 px-4 rounded-lg border ${type === 'estuche' ? 'bg-blue-600 border-blue-500 text-white' : 'border-slate-700 bg-slate-800 text-slate-300 hover:bg-slate-700'} transition`;
            
            // Si ya hay una marca y modelo seleccionados, actualizar el producto actual
            if(currentBrand && currentModel) {
                updateProductTitleForAccessory();
            }
        }

        // --- FUNCI√ìN PARA ACTUALIZAR EL T√çTULO DEL PRODUCTO ---
        function updateProductTitleForAccessory() {
            if(currentProduct && currentProduct.cat === 'fundas-laminas') {
                const typeText = currentType === 'funda' ? 'Funda para' : 'Estuche para';
                document.getElementById('p-title').innerText = `${currentProduct.titulo} - ${typeText} ${currentBrand} ${currentModel}`;
            }
        }

        // --- ACORDEONES PARA MARCAS Y MODELOS ---
        function initAccordions() {
            // Marca
            const brandAccordion = document.getElementById('brand-accordion');
            const brandList = document.getElementById('brand-list');
            const selectedBrandText = document.getElementById('selected-brand-text');
            
            brandAccordion.onclick = () => {
                brandList.classList.toggle('active');
                brandAccordion.querySelector('i').classList.toggle('fa-chevron-down');
                brandAccordion.querySelector('i').classList.toggle('fa-chevron-up');
            };

            // Llenar lista de marcas
            brandList.innerHTML = '';
            Object.keys(marcasModelos).forEach(marca => {
                const btn = document.createElement('button');
                btn.className = 'w-full text-left p-3 hover:bg-slate-800 transition';
                btn.innerText = marca;
                btn.onclick = () => {
                    currentBrand = marca;
                    selectedBrandText.innerHTML = `<i class="fa-solid fa-mobile-alt"></i> ${marca}`;
                    // Actualizar lista de modelos
                    updateModelList(marca);
                    updateProductTitleForAccessory();
                    // Cerrar acorde√≥n
                    brandList.classList.remove('active');
                    brandAccordion.querySelector('i').classList.remove('fa-chevron-up');
                    brandAccordion.querySelector('i').classList.add('fa-chevron-down');
                };
                brandList.appendChild(btn);
            });

            // Modelo
            const modelAccordion = document.getElementById('model-accordion');
            const modelList = document.getElementById('model-list');
            const selectedModelText = document.getElementById('selected-model-text');
            
            modelAccordion.onclick = () => {
                modelList.classList.toggle('active');
                modelAccordion.querySelector('i').classList.toggle('fa-chevron-down');
                modelAccordion.querySelector('i').classList.toggle('fa-chevron-up');
            };
        }

        function updateModelList(marca) {
            const modelList = document.getElementById('model-list');
            const selectedModelText = document.getElementById('selected-model-text');
            
            modelList.innerHTML = '';
            marcasModelos[marca].forEach(modelo => {
                const btn = document.createElement('button');
                btn.className = 'w-full text-left p-3 hover:bg-slate-800 transition';
                btn.innerText = modelo;
                btn.onclick = () => {
                    currentModel = modelo;
                    selectedModelText.innerHTML = `<i class="fa-solid fa-layer-group"></i> ${modelo}`;
                    updateProductTitleForAccessory();
                    // Cerrar acorde√≥n
                    modelList.classList.remove('active');
                    document.getElementById('model-accordion').querySelector('i').classList.remove('fa-chevron-up');
                    document.getElementById('model-accordion').querySelector('i').classList.add('fa-chevron-down');
                };
                modelList.appendChild(btn);
            });
        }

        // --- CARRITO FUNCTIONS ---
        function addToCart(id, flavor = null, brand = null, model = null, type = null) {
            const prod = inventario.find(p => p.id === id);
            if(!prod) return;

            // Verificar si el producto ya est√° en el carrito
            const existingItemIndex = carrito.findIndex(item => 
                item.id === id && 
                item.flavor === flavor && 
                item.brand === brand && 
                item.model === model &&
                item.type === type
            );

            if(existingItemIndex >= 0) {
                carrito[existingItemIndex].cantidad += 1;
            } else {
                carrito.push({
                    id: id,
                    cantidad: 1,
                    flavor: flavor,
                    brand: brand,
                    model: model,
                    type: type
                });
            }

            updateCart();
            Swal.fire({
                icon: 'success',
                title: '¬°Producto agregado!',
                text: 'El producto se ha a√±adido al carrito.',
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2000,
                timerProgressBar: true
            });
        }

        function addToCartFromModal() {
            if(!currentProduct) return;

            let flavor = null;
            if(currentProduct.sabores) {
                if(!currentFlavor) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Selecciona un sabor',
                        text: 'Por favor, selecciona un sabor antes de agregar al carrito.',
                        confirmButtonColor: '#3b82f6'
                    });
                    return;
                }
                flavor = currentFlavor;
            }

            let brand = null, model = null, type = null;
            if(currentProduct.cat === 'fundas-laminas') {
                if(!currentBrand || !currentModel) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Selecciona marca y modelo',
                        text: 'Por favor, selecciona la marca y modelo de tu tel√©fono.',
                        confirmButtonColor: '#3b82f6'
                    });
                    return;
                }
                brand = currentBrand;
                model = currentModel;
                type = currentType;
            }

            addToCart(currentProduct.id, flavor, brand, model, type);
            closeProduct();
        }

        // --- FUNCI√ìN COMPRAR AHORA ---
        function buyNow() {
            // Primero, agregamos al carrito (misma l√≥gica que addToCartFromModal)
            if(!currentProduct) return;

            let flavor = null;
            if(currentProduct.sabores) {
                if(!currentFlavor) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Selecciona un sabor',
                        text: 'Por favor, selecciona un sabor antes de agregar al carrito.',
                        confirmButtonColor: '#3b82f6'
                    });
                    return;
                }
                flavor = currentFlavor;
            }

            let brand = null, model = null, type = null;
            if(currentProduct.cat === 'fundas-laminas') {
                if(!currentBrand || !currentModel) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Selecciona marca y modelo',
                        text: 'Por favor, selecciona la marca y modelo de tu tel√©fono.',
                        confirmButtonColor: '#3b82f6'
                    });
                    return;
                }
                brand = currentBrand;
                model = currentModel;
                type = currentType;
            }

            addToCart(currentProduct.id, flavor, brand, model, type);
            closeProduct();
            openCart(); // Abrimos el carrito despu√©s de agregar
        }

        function removeFromCart(index) {
            carrito.splice(index, 1);
            updateCart();
        }

        function updateCart() {
            // Guardar en localStorage
            localStorage.setItem('carrito', JSON.stringify(carrito));

            // Actualizar contador
            const totalItems = carrito.reduce((sum, item) => sum + item.cantidad, 0);
            document.getElementById('cart-count').innerText = totalItems;
            document.getElementById('cart-count').style.display = totalItems > 0 ? 'flex' : 'none';

            // Renderizar carrito si est√° abierto
            if(document.getElementById('cart-modal').classList.contains('hidden') === false) {
                renderCart();
            }
        }

        function renderCart() {
            const container = document.getElementById('cart-items-container');
            const totalEl = document.getElementById('cart-total');

            if(carrito.length === 0) {
                container.innerHTML = '<p class="text-slate-500 text-center py-8">Tu carrito est√° vac√≠o</p>';
                totalEl.innerText = '0 Gs';
                return;
            }

            let total = 0;
            container.innerHTML = '';

            carrito.forEach((item, index) => {
                const prod = inventario.find(p => p.id === item.id);
                if(!prod) return;

                const subtotal = prod.precio * item.cantidad;
                total += subtotal;

                const div = document.createElement('div');
                div.className = 'bg-slate-800 rounded-xl p-4 flex items-center gap-4';
                div.innerHTML = `
                    <div class="w-16 h-16 rounded-lg overflow-hidden bg-slate-700 flex-shrink-0">
                        <img src="${prod.img}" class="w-full h-full object-cover" onerror="this.src='https://images.unsplash.com/photo-1556656793-08538906a9f8?w=800&q=80'">
                    </div>
                    <div class="flex-1 min-w-0">
                        <h4 class="font-bold text-white truncate">${prod.titulo}</h4>
                        ${item.flavor ? `<p class="text-sm text-slate-400">Sabor: ${item.flavor}</p>` : ''}
                        ${item.type ? `<p class="text-sm text-slate-400">${item.type === 'funda' ? 'Funda' : 'Estuche'} para: ${item.brand} ${item.model}</p>` : ''}
                        ${item.brand && item.model && !item.type ? `<p class="text-sm text-slate-400">Para: ${item.brand} ${item.model}</p>` : ''}
                        <p class="text-blue-400 font-bold">${subtotal.toLocaleString('es-PY')} Gs</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="changeQuantity(${index}, -1)" class="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center hover:bg-slate-600">
                            <i class="fa-solid fa-minus text-xs"></i>
                        </button>
                        <span class="w-8 text-center font-bold">${item.cantidad}</span>
                        <button onclick="changeQuantity(${index}, 1)" class="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center hover:bg-slate-600">
                            <i class="fa-solid fa-plus text-xs"></i>
                        </button>
                        <button onclick="removeFromCart(${index})" class="w-8 h-8 rounded-full bg-red-900/30 text-red-400 flex items-center justify-center hover:bg-red-800 hover:text-white ml-2">
                            <i class="fa-solid fa-trash text-xs"></i>
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });

            totalEl.innerText = total.toLocaleString('es-PY') + ' Gs';
        }

        function changeQuantity(index, delta) {
            const newQuantity = carrito[index].cantidad + delta;
            if(newQuantity < 1) {
                removeFromCart(index);
                return;
            }
            carrito[index].cantidad = newQuantity;
            updateCart();
        }

        function openCart() {
            renderCart();
            document.getElementById('cart-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeCart() {
            document.getElementById('cart-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function checkout() {
            if(carrito.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Carrito vac√≠o',
                    text: 'Agrega productos al carrito antes de finalizar la compra.',
                    confirmButtonColor: '#3b82f6'
                });
                return;
            }

            const phone = "595986725905"; 
            let text = `¬°Hola NovaStore! üëã\nQuiero realizar la siguiente compra:\n\n`;

            carrito.forEach(item => {
                const prod = inventario.find(p => p.id === item.id);
                text += `‚Ä¢ *${prod.titulo}*`;
                if(item.flavor) text += ` (Sabor: ${item.flavor})`;
                if(item.type) text += ` (${item.type === 'funda' ? 'Funda' : 'Estuche'} para: ${item.brand} ${item.model})`;
                text += `\n  Cantidad: ${item.cantidad}\n  Precio unitario: ${prod.precio.toLocaleString('es-PY')} Gs\n  Subtotal: ${(prod.precio * item.cantidad).toLocaleString('es-PY')} Gs\n\n`;
            });

            const total = carrito.reduce((sum, item) => {
                const prod = inventario.find(p => p.id === item.id);
                return sum + (prod.precio * item.cantidad);
            }, 0);

            text += `*Total: ${total.toLocaleString('es-PY')} Gs*\n\nMis datos:\n- Nombre: \n- Direcci√≥n: \n- Tel√©fono: \n\n¬øPodr√≠an confirmarme la disponibilidad y el tiempo de env√≠o?`;

            const url = `https://wa.me/${phone}?text=${encodeURIComponent(text)}`;
            
            window.open(url, '_blank');
            closeCart();
        }

        // --- FILTER FUNCTIONS ---
        function filter(btn, type) {
            // Update active button
            document.querySelectorAll('.cat-btn').forEach(b => {
                b.className = 'cat-btn px-4 py-1.5 rounded-full bg-slate-800 text-slate-300 text-sm whitespace-nowrap border border-slate-700 hover:bg-slate-700 transition hover:scale-105';
            });
            btn.className = 'cat-btn px-4 py-1.5 rounded-full bg-blue-600 text-white font-bold text-sm whitespace-nowrap shadow-lg shadow-blue-900/20 transition hover:scale-105';
            
            // Show loading
            showLoading();
            
            // Render after delay
            setTimeout(() => {
                renderProducts(type);
                hideLoading();
            }, 300);
        }

        // --- SEARCH FUNCTIONALITY ---
        function initSearch() {
            const searchInput = document.getElementById('search-input');
            const mobileSearchInput = document.getElementById('mobile-search-input');
            
            if(searchInput) {
                searchInput.addEventListener('input', function(e) {
                    searchProducts(e.target.value);
                });
            }
            
            if(mobileSearchInput) {
                mobileSearchInput.addEventListener('input', function(e) {
                    searchProducts(e.target.value);
                });
            }
        }

        function searchProducts(query) {
            if(!query.trim()) {
                renderProducts('todo');
                return;
            }
            
            const filtered = inventario.filter(prod => 
                prod.titulo.toLowerCase().includes(query.toLowerCase()) ||
                prod.desc.toLowerCase().includes(query.toLowerCase()) ||
                prod.cat.toLowerCase().includes(query.toLowerCase())
            );
            
            if(filtered.length === 0) {
                container.innerHTML = `
                    <div class="col-span-2 md:col-span-5 text-center py-20">
                        <i class="fa-solid fa-search text-4xl mb-3 text-slate-600"></i>
                        <p class="text-slate-500">No encontramos productos que coincidan con "${query}"</p>
                        <button onclick="renderProducts('todo')" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold transition">
                            Ver todos los productos
                        </button>
                    </div>`;
            } else {
                // Temporarily show filtered products
                container.innerHTML = '';
                filtered.forEach(prod => {
                    const card = document.createElement('div');
                    const precioFmt = prod.precio.toLocaleString('es-PY');
                    
                    card.className = 'product-card bg-slate-900 rounded-xl overflow-hidden border border-slate-800 relative cursor-pointer group hover:border-slate-600 transition-colors flex flex-col h-full';
                    card.onclick = () => openProduct(prod.id);

                    card.innerHTML = `
                        <div class="relative w-full aspect-square overflow-hidden bg-slate-800">
                            <img src="${prod.img}" 
                                 loading="lazy"
                                 onerror="this.src='https://images.unsplash.com/photo-1556656793-08538906a9f8?w=800&q=80'"
                                 class="w-full h-full object-cover group-hover:scale-105 transition duration-500" 
                                 alt="${prod.titulo}">
                        </div>
                        <div class="p-3 md:p-4 flex flex-col flex-1">
                            <p class="text-xs text-slate-400 mb-1">${prod.cat}</p>
                            <h3 class="text-sm md:text-base font-bold text-white leading-tight mb-2 line-clamp-2">${prod.titulo}</h3>
                            <div class="mt-auto pt-2 flex items-end justify-between border-t border-slate-800/50">
                                <p class="text-lg md:text-xl font-bold text-blue-400 font-mono">${precioFmt} Gs</p>
                                <button onclick="event.stopPropagation(); addToCart(${prod.id})" class="w-8 h-8 rounded-full bg-slate-800 border border-slate-700 flex items-center justify-center text-blue-500 hover:bg-blue-600 hover:text-white transition">
                                    <i class="fa-solid fa-plus text-xs"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }
        }

        // --- MOBILE MENU ---
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const overlay = document.getElementById('mobile-menu-overlay');
            
            if(menu.classList.contains('active')) {
                menu.classList.remove('active');
                overlay.classList.add('hidden');
            } else {
                menu.classList.add('active');
                overlay.classList.remove('hidden');
            }
        }

        function toggleSearch() {
            const searchBar = document.getElementById('mobile-search');
            searchBar.classList.toggle('hidden');
        }

        // --- LOADING STATES ---
        function showLoading() {
            loadingSkeleton.classList.remove('hidden');
            container.classList.add('opacity-50');
        }

        function hideLoading() {
            loadingSkeleton.classList.add('hidden');
            container.classList.remove('opacity-50');
        }

        // --- INITIALIZATION ---
        function init() {
            // Show initial loading
            showLoading();
            
            // Simulate loading delay
            setTimeout(() => {
                renderProducts('todo');
                hideLoading();
                
                // Initialize search
                initSearch();
                
                // Initialize cart count
                updateCart();
                
                // Add event listener for escape key
                document.addEventListener('keydown', function(e) {
                    if(e.key === 'Escape') {
                        closeProduct();
                        closeCart();
                        const menu = document.getElementById('mobile-menu');
                        if(menu.classList.contains('active')) {
                            toggleMobileMenu();
                        }
                    }
                });
            }, 500);
        }

        // Start everything
        window.onload = init;
    </script>
</body>
</html>